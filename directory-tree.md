.
├── .gitignore
├── .prettierignore
├── .replit
├── APP_DOCUMENTATION.md
├── CODEBASE_OVERVIEW.md
├── MOBILE_IMPROVEMENTS_GUIDE.md
├── attached_assets
│   ├── Goated Logo - Yellow.png
│   ├── IMG_2771.png
│   ├── IMG_2772.png
│   ├── IMG_2773.png
│   ├── IMG_2774.png
│   ├── IMG_9D85EA9079E5-1.jpeg
│   ├── Pasted--0-0-1-132-import-Router-from-express-import-db-from-db-import-users-from--1744083353717.txt
│   ├── Pasted--0-0-1-256-API-Sync-Management-Routes-Provides-endpoints-to-check-sync-status-an-1744083283778.txt
│   ├── Pasted--1-2-API-Response-Format-The-Goated-com-API-returns-data-in-this-structure-json-status--1744088304394.txt
│   ├── Pasted--1-207-1-234-GoatedVIPs-Platform-Documentation-Overview-GoatedVIPs-is-an-independent-pl-1744083324246.txt
│   ├── Pasted--Cleanup-Focus-Areas-Auth-System-Redundancies-Duplicate-logic-between-use-auth-tsx-auth-tsx-and--1743922998359.txt
│   ├── Pasted--Missing-Authentication-Check-for-Edit-Profile-Edit-profile-button-div-className-mt-4--1743919918759.txt
│   ├── Pasted--Profile-Service-A-centralized-service-for-managing-user-profiles-This-service--1743968951832.txt
│   ├── Pasted--User-Profile-Verification-Pattern-The-platform-implements-a-verification-system-to-link-Goated-c-1744083032322.txt
│   ├── Pasted--font-face-font-family-MonaSansCondensed-ExtraBold-src-url-fonts-MonaSansCondensed-Extr-1743306430754.txt
│   ├── Pasted-Account-Linking-Routes-server-routes-account-linking-ts-import-Router-from-express-import--1743922761474.txt
│   ├── Pasted-Backend-Cleanup-Restructuring-Plan-Here-s-a-comprehensive-backend-plan-for-cleaning-up-and-organiz-1743919751523.txt
│   ├── Pasted-CUSTOM-EMOJI-LIST-GOATED-LOGO-5956308779791291440-GOAT-RACE-5222141780476046109-BONUS-BON-1739795219454.txt
│   ├── Pasted-CUSTOM-EMOJI-LIST-GOATED-LOGO-5956308779791291440-GOAT-RACE-5222141780476046109-BONUS-BON-1739795510347.txt
│   ├── Pasted-Comprehensive-Profile-Auth-System-Enhancement-Plan-Based-on-your-feedback-and-the-database-structu-1743920440418.txt
│   ├── Pasted-Comprehensive-Redundancy-Optimization-Analysis-Based-on-my-examination-of-the-codebase-I-ve-ident-1744580907874.txt
│   ├── Pasted-Create-a-devguide-md-file-inside-client-src-components-memory-bank-that-serves-as-a-comprehensive-d-1744436110185.txt
│   ├── Pasted-Current-Implementation-Analysis-User-Registration-Flow-Frontend-Registration-The-AuthModal-tsx-com-1743918942427.txt
│   ├── Pasted-Current-Implementation-Analysis-User-Registration-Flow-Frontend-Registration-The-AuthModal-tsx-com-1743921173083.txt
│   ├── Pasted-Data-Transformation-and-Sorting-One-of-the-most-important-aspects-of-our-system-is-how-we-transform--1744083535901.txt
│   ├── Pasted-Database-Guide-GoatedVIPs-Platform-Overview-This-document-provides-a-comprehensive-guide-to-the-dat-1743917530436.txt
│   ├── Pasted-Database-Structure-Core-User-Tables-users-table-Primary-user-data-storage-Contains-basic-user-inf-1744255942517.txt
│   ├── Pasted-GoatedVips-Upgrade-Guide-Architectural-Organizational-Improvements-This-guide-outlines-the-steps--1743915745453.txt
│   ├── Pasted-In-our-application-user-profiles-are-created-through-a-combination-of-user-registration-and-verific-1743362502190.txt
│   ├── Pasted-It-appears-you-re-encountering-an-issue-with-user-profiles-not-displaying-the-actual-wager-data-in-t-1744262319640.txt
│   ├── Pasted-It-looks-like-you-ve-made-great-progress-in-resolving-the-issue-with-fetching-users-by-Goated-ID-Yo-1743364008515.txt
│   ├── Pasted-Objective-Review-and-refine-the-current-login-registration-button-behavior-and-structure-across-bot-1744334095038.txt
│   ├── Pasted-Profile-Ownership-Distinction-Fix-Step-1-Create-a-Type-Safe-Utility-Function-client-src-services-1743920475103.txt
│   ├── Pasted-SOMETHING-WENT-WRONG-Cannot-read-properties-of-undefined-reading-startDate-ERROR-DETAILS-TypeE-1744091421855.txt
│   ├── Pasted-This-is-extremely-well-structured-already-modular-cache-aware-animation-enabled-and-responsive-Y-1744257879333.txt
│   ├── Pasted-Using-normalized-API-URL-https-api-goated-com-user2-affiliate-referral-leaderboard-2RW440E-Attemp-1744177652836.txt
│   ├── Pasted-We-re-encountering-issues-with-our-Monthly-Race-page-The-following-problems-need-immediate-analysis-1744421854174.txt
│   ├── Pasted-We-re-encountering-issues-with-our-Monthly-Race-page-The-following-problems-need-immediate-analysis-1744422216297.txt
│   ├── Pasted-We-re-encountering-issues-with-our-Monthly-Race-page-The-following-problems-need-immediate-analysis-1744422216444.txt
│   ├── Pasted-When-we-fetch-data-from-the-external-API-we-make-requests-with-proper-authentication-const-respons-1743381316952.txt
│   ├── Pasted-chunk-RPCDYKBN-js-v-4c43aa16-521-Warning-React-has-detected-a-change-in-the-order-of-Hooks-called-b-1744187216184.txt
│   ├── Pasted-chunk-RPCDYKBN-js-v-4c43aa16-521-Warning-React-has-detected-a-change-in-the-order-of-Hooks-called-b-1744187230149.txt
│   ├── Pasted-chunk-RPCDYKBN-js-v-4c43aa16-521-Warning-React-has-detected-a-change-in-the-order-of-Hooks-called-b-1744187330150.txt
│   ├── Pasted-here-are-expert-level-enhancements-and-ideas-to-elevate-this-codebase-from-solid-to-damn-that-s-el-1744257915924.txt
│   ├── Pasted-i-ll-provide-a-detailed-explanation-of-our-database-setup-and-how-we-handle-data-for-leaderboards-w-1743983871575.txt
│   ├── Pasted-import-React-useMemo-useCallback-from-react-import-Trophy-TrendingUp-from-lucide-reac-1743925749736.txt
│   ├── Pasted-import-Router-from-express-import-db-from-db-import-users-from-db-schema-impo-1743917597117.txt
│   ├── Pasted-import-pgTable-text-serial-integer-timestamp-boolean-decimal-jsonb-from--1743362042995.txt
│   ├── Pasted-now-for-the-other-cards-on-the-homepage-promotions-svg-xmlns-http-www-w3-org-2000-svg-width--1743319514681.txt
│   ├── Pasted-oatedVips-Upgrade-Guide-Architectural-Organizational-Improvements-This-guide-outlines-the-steps-f-1743914657961.txt
│   ├── Pasted-use-leaderboard-ts-52-WebSocket-connection-to-wss-32227c5c-bbf5-490b-9302-a351e215f0e5-00-bv3r7s9-1744187174819.txt
│   ├── Screenshot 2025-01-12 at 7.08.32 PM.png
│   ├── Screenshot 2025-01-12 at 8.50.19 PM.png
│   ├── Screenshot 2025-01-12 at 8.50.24 PM.png
│   ├── Screenshot 2025-01-12 at 8.50.29 PM.png
│   ├── Screenshot 2025-01-13 at 2.45.11 PM.png
│   ├── Screenshot 2025-01-13 at 2.45.15 PM.png
│   ├── Screenshot 2025-01-15 at 10.48.41 PM.png
│   ├── Screenshot 2025-01-20 at 4.12.27 PM.png
│   ├── Screenshot 2025-01-23 at 3.40.53 PM.png
│   ├── Screenshot 2025-01-23 at 4.00.35 PM.png
│   ├── Screenshot 2025-01-23 at 4.00.44 PM.png
│   ├── Screenshot 2025-01-23 at 4.00.52 PM.png
│   ├── Screenshot 2025-01-23 at 4.03.56 PM.png
│   ├── Screenshot 2025-01-23 at 4.04.04 PM.png
│   ├── Screenshot 2025-01-23 at 4.04.10 PM.png
│   ├── Screenshot 2025-01-24 at 12.29.52 AM.png
│   ├── Screenshot 2025-01-24 at 12.30.00 AM.png
│   ├── Screenshot 2025-01-26 at 8.26.20 PM.png
│   ├── Screenshot 2025-03-30 at 2.31.36 AM.png
│   ├── Screenshot 2025-04-09 at 8.56.54 PM.png
│   ├── Untitled design - 4.png
│   ├── Untitled.jpg
│   ├── image_1744256741759.png
│   └── img-wKBWzo4omZlP4aEEiRXFG.jpeg
├── client
│   ├── index.html
│   ├── public
│   │   ├── images
│   │   │   ├── 29340105feb4436dbebad52ba45e35ac.png
│   │   │   ├── FINAL.mp4
│   │   │   ├── Final LOGO LIVE.svg
│   │   │   ├── GIFT.png
│   │   │   ├── Goated Emblems
│   │   │   │   ├── bronze.e6ea941b.svg
│   │   │   │   ├── copper.548d79cf.svg
│   │   │   │   ├── diamond.ddf47a1e.svg
│   │   │   │   ├── emerald.46bd38eb.svg
│   │   │   │   ├── gold.1c810178.svg
│   │   │   │   ├── pearl.1815809f.svg
│   │   │   │   ├── platinum.d258f583.svg
│   │   │   │   ├── sapphire.91e6756b.svg
│   │   │   │   └── silver.8e3ec67f.svg
│   │   │   ├── Goated Logo - Black.png
│   │   │   ├── Goated Logo - Yellow.png
│   │   │   ├── Goated logo with text.png
│   │   │   ├── Goated logo with text1.png
│   │   │   ├── GoombasOfficial.MP4
│   │   │   ├── How
│   │   │   │   ├── Step3.mp4
│   │   │   │   ├── step1.mp4
│   │   │   │   └── step2.mp4
│   │   │   ├── PROMOS
│   │   │   │   ├── CHLNG1.WEBP
│   │   │   │   ├── LUNAR1.WEBP
│   │   │   │   ├── PRAG1.WEBP
│   │   │   │   └── WEEKLYRACE.WEBP
│   │   │   ├── Page Headers
│   │   │   │   ├── BONUSHEAD.MP4
│   │   │   │   ├── PROMOHEAD.MP4
│   │   │   │   ├── TIPSHEAD.MP4
│   │   │   │   ├── VIPHEAD.MP4
│   │   │   │   └── WAGERLB.MP4
│   │   │   ├── RACEFLAG.MP4
│   │   │   ├── README.md
│   │   │   ├── logo-neon.png
│   │   │   ├── main.svg
│   │   │   ├── preload.PNG
│   │   │   └── race.gif
│   │   └── logo.svg
│   ├── src
│   │   ├── App.tsx
│   │   ├── components
│   │   │   ├── AdminMenu.tsx
│   │   │   ├── AdminRoute.tsx
│   │   │   ├── AffiliateStats.tsx
│   │   │   ├── AuthModal.tsx
│   │   │   ├── AuthSection.tsx
│   │   │   ├── BonusCodeHeroCard.tsx
│   │   │   ├── CountdownTimer.tsx
│   │   │   ├── CryptoSwapHomeWidget.tsx
│   │   │   ├── CryptoSwapTooltip.tsx
│   │   │   ├── CryptoSwapWidget.tsx
│   │   │   ├── ErrorFallback.tsx
│   │   │   ├── FeatureCarousel.tsx
│   │   │   ├── FeaturesSection.tsx
│   │   │   ├── FloatingSupport.tsx
│   │   │   ├── Footer.tsx
│   │   │   ├── Header.tsx
│   │   │   ├── Layout.tsx
│   │   │   ├── LeaderboardTable.tsx
│   │   │   ├── LoadingSpinner.tsx
│   │   │   ├── MVPCards.tsx
│   │   │   ├── MVPCardsTest.tsx
│   │   │   ├── MobileNavigation.tsx
│   │   │   ├── MobileSearchDropdown.tsx
│   │   │   ├── NavigationLinks.tsx
│   │   │   ├── PageTransition.tsx
│   │   │   ├── ParticleBackground.tsx
│   │   │   ├── PreLoader.tsx
│   │   │   ├── QuickProfile.tsx
│   │   │   ├── RaceTimer.tsx
│   │   │   ├── ScrollToTop.tsx
│   │   │   ├── SocialShare.tsx
│   │   │   ├── UserMenu.tsx
│   │   │   ├── UserSearch.tsx
│   │   │   ├── UsernameSearch.tsx
│   │   │   ├── UtilityPanel.tsx
│   │   │   ├── WheelSpinIndicator.tsx
│   │   │   ├── chat
│   │   │   │   └── ChatInterface.tsx
│   │   │   ├── features
│   │   │   │   ├── FeatureCard.tsx
│   │   │   │   └── FeatureSection.tsx
│   │   │   ├── icons
│   │   │   │   └── SpeedIcon.tsx
│   │   │   ├── memory-bank
│   │   │   │   ├── activeContext.md
│   │   │   │   ├── admin-system-audit.md
│   │   │   │   ├── apiIntegration.md
│   │   │   │   ├── auth-system-audit.md
│   │   │   │   ├── auth-system-cleanup-plan.md
│   │   │   │   ├── codebase-optimization-master-plan.md
│   │   │   │   ├── codebase-redundancy-analysis.md
│   │   │   │   ├── dataStructure.md
│   │   │   │   ├── devguide.md
│   │   │   │   ├── header-optimization.md
│   │   │   │   ├── interfacePatterns.md
│   │   │   │   ├── layout-refactoring.md
│   │   │   │   ├── platformFeatures.md
│   │   │   │   ├── productContext.md
│   │   │   │   ├── profile-system-business-benefits.md
│   │   │   │   ├── profile-system-enhancement.md
│   │   │   │   ├── profile-system-implementation-guide.md
│   │   │   │   ├── profile-system-migration-plan.md
│   │   │   │   ├── progress.md
│   │   │   │   ├── projectbrief.md
│   │   │   │   ├── route-structure-standardization-plan.md
│   │   │   │   ├── systemPatterns.md
│   │   │   │   ├── techContext.md
│   │   │   │   ├── tier-system-consolidation-plan.md
│   │   │   │   └── user-profile-audit.md
│   │   │   ├── mvp
│   │   │   │   ├── MVPCard.tsx
│   │   │   │   ├── MVPCards.tsx
│   │   │   │   └── index.ts
│   │   │   ├── profile
│   │   │   │   ├── AccountLinkingDialog.tsx
│   │   │   │   ├── EnhancedProfileLayout.tsx
│   │   │   │   ├── EnhancedProfileTierProgress.tsx
│   │   │   │   ├── EnhancedQuickProfileCard.tsx
│   │   │   │   ├── ProfileAchievements.tsx
│   │   │   │   ├── ProfileActions.tsx
│   │   │   │   ├── ProfileCard.tsx
│   │   │   │   ├── ProfileCardBio.tsx
│   │   │   │   ├── ProfileCardFooter.tsx
│   │   │   │   ├── ProfileCardHeader.tsx
│   │   │   │   ├── ProfileCardStats.tsx
│   │   │   │   ├── ProfileCardStatus.tsx
│   │   │   │   ├── ProfileEmblem.tsx
│   │   │   │   ├── ProfileHeader.tsx
│   │   │   │   ├── ProfileLayout.tsx
│   │   │   │   ├── ProfileStats.tsx
│   │   │   │   ├── ProfileTierProgress.tsx
│   │   │   │   ├── QuickProfile.tsx
│   │   │   │   ├── QuickProfileCard.tsx
│   │   │   │   ├── TierProgress.tsx
│   │   │   │   └── index.ts
│   │   │   ├── skeletons
│   │   │   │   ├── CardSkeleton.tsx
│   │   │   │   ├── DashboardSkeleton.tsx
│   │   │   │   ├── LeaderboardSkeleton.tsx
│   │   │   │   ├── ProfileSkeleton.tsx
│   │   │   │   └── index.ts
│   │   │   ├── ui
│   │   │   │   ├── accordion.tsx
│   │   │   │   ├── alert-dialog.tsx
│   │   │   │   ├── alert.tsx
│   │   │   │   ├── aspect-ratio.tsx
│   │   │   │   ├── avatar.tsx
│   │   │   │   ├── badge.tsx
│   │   │   │   ├── breadcrumb.tsx
│   │   │   │   ├── button.tsx
│   │   │   │   ├── calendar.tsx
│   │   │   │   ├── card.tsx
│   │   │   │   ├── carousel.tsx
│   │   │   │   ├── chart.tsx
│   │   │   │   ├── checkbox.tsx
│   │   │   │   ├── collapsible.tsx
│   │   │   │   ├── command.tsx
│   │   │   │   ├── context-menu.tsx
│   │   │   │   ├── dialog.tsx
│   │   │   │   ├── drawer.tsx
│   │   │   │   ├── dropdown-menu.tsx
│   │   │   │   ├── form.tsx
│   │   │   │   ├── hover-card.tsx
│   │   │   │   ├── input-otp.tsx
│   │   │   │   ├── input.tsx
│   │   │   │   ├── label.tsx
│   │   │   │   ├── loading-spinner.tsx
│   │   │   │   ├── menubar.tsx
│   │   │   │   ├── nav-item.tsx
│   │   │   │   ├── navigation-menu.tsx
│   │   │   │   ├── pagination.tsx
│   │   │   │   ├── popover.tsx
│   │   │   │   ├── progress.tsx
│   │   │   │   ├── radio-group.tsx
│   │   │   │   ├── resizable.tsx
│   │   │   │   ├── scroll-area.tsx
│   │   │   │   ├── select.tsx
│   │   │   │   ├── separator.tsx
│   │   │   │   ├── sheet.tsx
│   │   │   │   ├── sidebar.tsx
│   │   │   │   ├── skeleton.tsx
│   │   │   │   ├── slider.tsx
│   │   │   │   ├── spinner.tsx
│   │   │   │   ├── switch.tsx
│   │   │   │   ├── table.tsx
│   │   │   │   ├── tabs.tsx
│   │   │   │   ├── textarea.tsx
│   │   │   │   ├── theme-toggle.tsx
│   │   │   │   ├── toast.tsx
│   │   │   │   ├── toaster.tsx
│   │   │   │   ├── toggle-group.tsx
│   │   │   │   ├── toggle.tsx
│   │   │   │   └── tooltip.tsx
│   │   │   └── username
│   │   │       ├── ClickableUsername.tsx
│   │   │       └── index.ts
│   │   ├── config
│   │   │   └── feature-flags.ts
│   │   ├── data
│   │   │   └── tier-definitions.ts
│   │   ├── hooks
│   │   │   ├── queries
│   │   │   │   ├── index.ts
│   │   │   │   ├── useLeaderboard.ts
│   │   │   │   └── useUserProfile.ts
│   │   │   ├── use-auth.ts
│   │   │   ├── use-auth.tsx
│   │   │   ├── use-debounce.tsx
│   │   │   ├── use-leaderboard.ts
│   │   │   ├── use-media-query.ts
│   │   │   ├── use-mobile.tsx
│   │   │   ├── use-profile.tsx
│   │   │   ├── use-toast.ts
│   │   │   ├── use-user.ts
│   │   │   └── useApi.ts
│   │   ├── index.css
│   │   ├── lib
│   │   │   ├── animation-presets.ts
│   │   │   ├── auth.tsx
│   │   │   ├── navigation.ts
│   │   │   ├── protected-route.tsx
│   │   │   ├── queryClient.ts
│   │   │   ├── style-constants.ts
│   │   │   ├── tier-utils.ts
│   │   │   └── utils.ts
│   │   ├── main.tsx
│   │   ├── pages
│   │   │   ├── BonusCodes.tsx
│   │   │   ├── Challenges.tsx
│   │   │   ├── CryptoSwap.tsx
│   │   │   ├── Dashboard.tsx
│   │   │   ├── EnhancedUserProfile.tsx
│   │   │   ├── GoatedToken.tsx
│   │   │   ├── GoombasAdminDashboard.tsx
│   │   │   ├── GoombasAdminLogin.tsx
│   │   │   ├── Help.tsx
│   │   │   ├── Home.tsx
│   │   │   ├── HowItWorks.tsx
│   │   │   ├── Leaderboard.tsx
│   │   │   ├── Promotions.tsx
│   │   │   ├── ProvablyFair.tsx
│   │   │   ├── Telegram.tsx
│   │   │   ├── UserProfile.tsx
│   │   │   ├── VipProgram.tsx
│   │   │   ├── VipTransfer.tsx
│   │   │   ├── WagerRaces.tsx
│   │   │   ├── WheelChallenge.tsx
│   │   │   ├── WheelSpin.tsx
│   │   │   ├── admin
│   │   │   │   ├── AnalyticsDashboard.tsx
│   │   │   │   ├── BonusCodeManagement.tsx
│   │   │   │   ├── NotificationManagement.tsx
│   │   │   │   ├── SupportManagement.tsx
│   │   │   │   ├── TransformationDebug.tsx
│   │   │   │   ├── UserManagement.tsx
│   │   │   │   └── WagerRaceManagement.tsx
│   │   │   ├── auth-page.tsx
│   │   │   ├── faq.tsx
│   │   │   ├── not-found.tsx
│   │   │   ├── notification-preferences.tsx
│   │   │   ├── profile.tsx
│   │   │   ├── support.tsx
│   │   │   └── tips-and-strategies.tsx
│   │   ├── services
│   │   │   ├── error.ts
│   │   │   └── profileService.ts
│   │   ├── styles
│   │   │   └── fonts.css
│   │   └── utils
│   │       ├── cn.ts
│   │       └── format.ts
│   └── tailwind.config.ts
├── cookies.txt
├── db
│   ├── index.ts
│   ├── migrations
│   │   └── manually-update-schema.sql
│   ├── schema
│   │   ├── bonus.ts
│   │   ├── challenges.ts
│   │   ├── telegram.ts
│   │   ├── users.ts
│   │   └── verification.ts
│   └── schema.ts
├── db-push.js
├── db-reset-simple.ts
├── db-update.js
├── debug
│   └── routes.ts.copy
├── directory-tree.md
├── drizzle.config.ts
├── fonts
│   ├── GeistMono-Black.woff2
│   ├── GeistMono-Regular.woff2
│   ├── MonaSansCondensed-ExtraBold.woff2
│   ├── MonaSansExpanded-ExtraBold.woff2
│   └── MonaSansExpanded-SemiBold.woff2
├── generated-icon.png
├── layout_backup.tsx
├── mvpcards_full.txt
├── package-lock.json
├── package.json
├── postcss.config.js
├── replit.nix
├── server
│   ├── auth.ts
│   ├── config
│   │   ├── api.ts
│   │   ├── auth.ts
│   │   ├── environment.ts
│   │   ├── paths.ts
│   │   └── websocket.ts
│   ├── db-reset.ts
│   ├── docs
│   │   └── bonus-codes-api.md
│   ├── index.ts
│   ├── middleware
│   │   ├── auth.ts                 # ✅ clean (High Modularity/Cohesion) — Authenticates user via token, attaches user to req. Used by most user/account routes. Needs to replace inline `req.user?.id` checks.
│   │   ├── admin.ts                # ✅ clean (High Modularity/Cohesion) — Verifies admin session (`req.session.isAdmin`). Used by all `/admin` routes. Needs to replace inline `req.user?.admin` checks.
│   │   ├── domain-handler.ts       # ✅ clean (High Modularity/Cohesion) — Marks requests from `/goombas.net` domain. Global. Ensure all domain logic uses this.
│   │   ├── error-handler.ts        # ✅ clean (High Modularity/Cohesion) — Global error and 404 handler. Standardizes error responses. Universal. Ensure all custom errors use AppError.
│   │   └── rate-limit.ts           # ✅ clean (High Modularity/Cohesion) — Provides login and API rate limiters. Used by Login/API endpoints. Audit for missing usage on sensitive routes.
│   ├── routes
│   │   ├── account-linking.ts
│   │   ├── apiRoutes.ts
│   │   ├── bonus-challenges.ts
│   │   ├── challenges.ts
│   │   ├── goombas-admin.ts
│   │   ├── users.ts
│   │   └── webhook.ts
│   ├── routes.ts
│   ├── routes.ts.bak
│   ├── services
│   │   ├── cacheService.ts
│   │   ├── goatedApiService.ts
│   │   ├── platformApiService.ts
│   │   ├── telegramBotService.ts
│   │   └── userService.ts
│   ├── tasks
│   │   └── dataSyncTasks.ts
│   ├── templates
│   │   └── verification-email.ts
│   ├── types
│   │   └── session.d.ts
│   ├── utils
│   │   ├── auth-utils.ts
│   │   ├── cleanup-duplicates.ts
│   │   ├── error.ts
│   │   ├── logger.ts
│   │   ├── response-utils.ts
│   │   └── users.ts
│   └── vite.ts
├── tailwind.config.ts
├── temp-script.js
├── theme.json
├── tsconfig.json
├── vite.config.ts
└── vitest.config.ts

45 directories, 404 files

// Backend services audit updated [2024-06-09]

server/services/
├── wagerLeaderboardSync.ts      # ✅ clean — Syncs Goated wager leaderboard to DB. Upserts wager fields for all users. No business logic, just sync. Uses goatedApiService. Runs on startup & interval.
├── telegramBotService.ts        # ✅ clean — Telegram bot integration. Handles /start and /verify commands, user linking. Singleton, minimal logic.
├── userService.ts               # 🧹 needs cleanup — Central user DB service. CRUD, search, profile ensure, Goated linking, verification. Some overlap with platformApiService. Some logic could be further modularized.
├── goatedApiService.ts          # ✅ clean — Handles all external Goated.com API calls. Retry logic, token mgmt, error handling. No business logic, just API. Good separation.
├── platformApiService.ts        # 🧹 needs cleanup — All internal business logic: transforms, syncs, race logic, DB ops, endpoints. Large, some tight coupling (API+DB+logic). Some duplication with userService.
├── cacheService.ts              # ✅ clean — In-memory cache with TTL, namespaces, stats, stale-while-revalidate, error caching. Good separation. Could be extracted to core utils if used elsewhere.

// 📦 Route Inventory & Refactor Notes (June 2025)
// Added after comprehensive audit of all backend routes. See scope.md for summary and refactor checklist.

| Endpoint/Path                       | Method | Feature(s)         | Middleware                | Key Dependencies         | Coupling Level         | Refactor Notes / Issues                                                                                  |
|--------------------------------------|--------|--------------------|---------------------------|-------------------------|------------------------|----------------------------------------------------------------------------------------------------------|
| **users.ts**                        |        |                    |                           |                         |                        |                                                                                                          |
| `/search`                           | GET    | 🟢🟡                | none                      | db                      | Fat (direct DB/logic)  | Should call userService for search logic.                                                                |
| `/:id`                              | GET    | 🟢🟡                | none                      | db                      | Fat (direct DB/logic)  | Should call userService for lookup/formatting.                                                           |
| `/leaderboard/:timeframe`            | GET    | 🟡                 | none                      | db                      | Fat (direct DB/logic)  | Should call leaderboard/stat service.                                                                    |
| `/admin/all`                        | GET    | 🔴                 | requireAuth, requireAdmin | db                      | Fat (direct DB/logic)  | Should call userService for admin queries.                                                               |
| `/ensure-profile`                    | POST   | 🟢                 | none                      | ensureUserProfile       | Service-wrapped        | Should call a dedicated profileService, not index.                                                       |
| `/:id/stats`                        | GET    | 🟡                 | none                      | db                      | Fat (direct DB/logic)  | Should call userService for stats/tier logic.                                                            |
| `/:id`                              | PATCH  | 🟢                 | none                      | db                      | Fat (direct DB/logic)  | Should call userService for updates.                                                                     |
| `/batch`                            | GET    | 🟢🟡                | none                      | db                      | Fat (direct DB/logic)  | Should call userService for batch fetch.                                                                 |
| **account-linking.ts**               |        |                    |                           |                         |                        |                                                                                                          |
| `/request-link`                     | POST   | 🟢                 | (auth via req.user)        | userService             | Service-wrapped        | Good, but should use explicit middleware for auth.                                                       |
| `/unlink-account`                    | POST   | 🟢                 | (auth via req.user)        | db                      | Fat (direct DB/logic)  | Should use userService for unlink logic.                                                                 |
| `/check-goated-username/:username`   | GET    | 🟢                 | (auth via req.user)        | goatedApiService        | Service-wrapped        | Good, but should use explicit middleware for auth.                                                       |
| `/admin-approve-link`                | POST   | 🟢🔴               | (admin via req.user)       | userService             | Service-wrapped        | Good, but should use explicit admin middleware.                                                          |
| `/admin-reject-link`                 | POST   | 🟢🔴               | (admin via req.user)       | userService             | Service-wrapped        | Good, but should use explicit admin middleware.                                                          |
| **goombas-admin.ts**                 |        |                    |                           |                         |                        |                                                                                                          |
| `/admin/login`                      | POST   | 🔴                 | none                      | auth-utils              | Service-wrapped        | Good, uses utility for validation.                                                                       |
| `/admin/logout`                     | POST   | requireAdmin        | auth-utils                | Service-wrapped         | Good, uses utility for session clear.                                                                    |
| `/admin/analytics`                   | GET    | 🔴                 | requireAdmin               | db                      | Fat (direct DB/logic)  | Should move analytics logic to a service.                                                                |
| `/admin/users`                       | GET    | 🔴                 | requireAdmin               | db                      | Fat (direct DB/logic)  | Should call userService.                                                                                 |
| `/admin/users/:id`                   | GET    | 🔴                 | requireAdmin               | db                      | Fat (direct DB/logic)  | Should call userService.                                                                                 |
| `/admin/auth-status`                 | GET    | none                | session                    | Service-wrapped         | Good, simple session check.                                                                              |
| **webhook.ts**                       |        | 🟠                 | rateLimiter                | bot, telegram           | Service-wrapped         | Good, all logic delegated to bot handlers.                                                               |
| **bonus-challenges.ts**              |        |                    |                           |                         |                        |                                                                                                          |
| `/bonus-codes`                       | GET    | 🟡                 | rateLimiter                | db                      | Service-wrapped         | Good, uses rate limit and caching headers.                                                               |
| `/admin/bonus-codes`                 | GET    | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/admin/bonus-codes`                 | POST   | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/admin/bonus-codes/:id`             | PUT    | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/admin/bonus-codes/:id`             | DELETE | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| **challenges.ts**                    |        | 🟡                 | isAdmin (admin routes)      | db                      | Service-wrapped (admin) | Good, admin and public routes separated.                                                                 |
| `/admin/challenges`                  | GET    | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/admin/challenges`                  | POST   | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/admin/challenges/:id`              | PUT    | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/admin/challenges/:id`              | DELETE | 🔴                 | isAdmin                    | db                      | Service-wrapped         | Good, uses admin middleware.                                                                             |
| `/challenges`                        | GET    | 🟡                 | none                       | db                      | Service-wrapped         | Good, public fetch.                                                                                      |
| `/challenges/:id/entries`            | POST   | 🟡                 | (auth via req.user)         | db                      | Fat (direct DB/logic)  | Should use explicit auth middleware.                                                                     |
| **apiRoutes.ts**                     |        |                    |                           |                         |                        |                                                                                                          |
| `/affiliate/stats`                   | GET    | 🔵🟡               | cache(15min)                | platformApiService       | Service-wrapped         | Good, all logic in service.                                                                              |
| `/wager-races/current`               | GET    | 🟣                 | cache(15min)                | platformApiService       | Service-wrapped         | Good, all logic in service.                                                                              |
| `/wager-races/previous`              | GET    | 🟣                 | cache(15min)                | platformApiService       | Service-wrapped         | Good, all logic in service.                                                                              |
| `/wager-race/position`               | GET    | 🟣                 | none                        | platformApiService       | Service-wrapped         | Good, all logic in service.                                                                              |
| `/sync/trigger`                      | POST   | 🔴                 | none                        | platformApiService       | Service-wrapped         | Should require admin middleware.                                                                         |
| `/test/goated-raw`                   | GET    | none                | goatedApiService            | Service-wrapped         | Good, for debugging only.                                                                               |

### Refactor Checklist
- [ ] Migrate all direct DB/business logic in `users.ts` to `userService`/`profileService`
- [ ] Move analytics and user management logic in `goombas-admin.ts` to `adminService` or `userService`
- [ ] Enforce explicit auth/admin middleware in `account-linking.ts` and `challenges.ts`
- [ ] Add admin middleware to `/sync/trigger` in `apiRoutes.ts`
- [x] Keep `apiRoutes.ts` as a clean controller layer using proper services

// 🧱 Middleware Inventory & Refactor Checklist (June 2025)
// Added after comprehensive audit of all backend middleware. See scope.md for summary and refactor checklist.

server/middleware/
├── auth.ts                 # ✅ clean (High Modularity/Cohesion) — Authenticates user via token, attaches user to req. Used by most user/account routes. Needs to replace inline `req.user?.id` checks.
├── admin.ts                # ✅ clean (High Modularity/Cohesion) — Verifies admin session (`req.session.isAdmin`). Used by all `/admin` routes. Needs to replace inline `req.user?.admin` checks.
├── domain-handler.ts       # ✅ clean (High Modularity/Cohesion) — Marks requests from `/goombas.net` domain. Global. Ensure all domain logic uses this.
├── error-handler.ts        # ✅ clean (High Modularity/Cohesion) — Global error and 404 handler. Standardizes error responses. Universal. Ensure all custom errors use AppError.
├── rate-limit.ts           # ✅ clean (High Modularity/Cohesion) — Provides login and API rate limiters. Used by Login/API endpoints. Audit for missing usage on sensitive routes.
