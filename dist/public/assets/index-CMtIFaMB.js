import{a as e,r as s,u as r,d as t,e as a}from"./vendor-DUN5LRNE.js";import{bv as n,bw as i,bx as c,z as o,c as l,d,j as m,C as u,as as h,at as x,L as j,au as f,a as p,ba as g,b as y,bb as b,bc as N,F as v,k as w,l as A,m as E,n as S,I as k,o as R,B as U,a4 as P,R as L,ai as C,by as O,bz as T,r as V,ab as K,ac as q,ad as D,ae as F,af as I,ag as G,u as W,$ as z}from"./ui-B__I2I3R.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var B,M={},Y=e;B=M.createRoot=Y.createRoot,M.hydrateRoot=Y.hydrateRoot;const $=(e,s,r)=>{if(e&&"reportValidity"in e){const t=n(r,s);e.setCustomValidity(t&&t.message||""),e.reportValidity()}},J=(e,s)=>{for(const r in s.fields){const t=s.fields[r];t&&t.ref&&"reportValidity"in t.ref?$(t.ref,r,e):t.refs&&t.refs.forEach((s=>$(s,r,e)))}},H=(e,s)=>{s.shouldUseNativeValidation&&J(e,s);const r={};for(const t in e){const a=n(s.fields,t),c=Object.assign(e[t]||{},{ref:a&&a.ref});if(Q(s.names||Object.keys(e),t)){const e=Object.assign({},n(r,t));i(e,"root",c),i(r,t,e)}else i(r,t,c)}return r},Q=(e,s)=>e.some((e=>e.startsWith(s+".")));var X=function(e,s){for(var r={};e.length;){var t=e[0],a=t.code,n=t.message,i=t.path.join(".");if(!r[i])if("unionErrors"in t){var o=t.unionErrors[0].errors[0];r[i]={message:o.message,type:o.code}}else r[i]={message:n,type:a};if("unionErrors"in t&&t.unionErrors.forEach((function(s){return s.errors.forEach((function(s){return e.push(s)}))})),s){var l=r[i].types,d=l&&l[t.code];r[i]=c(i,s,r,a,d?[].concat(d,t.message):t.message)}e.shift()}return r},Z=function(e,s,r){return void 0===r&&(r={}),function(t,a,n){try{return Promise.resolve(function(a,i){try{var c=Promise.resolve(e["sync"===r.mode?"parse":"parseAsync"](t,s)).then((function(e){return n.shouldUseNativeValidation&&J({},n),{errors:{},values:r.raw?t:e}}))}catch(o){return i(o)}return c&&c.then?c.then(void 0,i):c}(0,(function(e){if(s=e,Array.isArray(null==s?void 0:s.errors))return{values:{},errors:H(X(e.errors,!n.shouldUseNativeValidation&&"all"===n.criteriaMode),n)};var s;throw e})))}catch(i){return Promise.reject(i)}}};const _=o.object({username:o.string().min(1,"Username is required"),password:o.string().min(1,"Password is required"),secretKey:o.string().min(1,"Secret key is required")});function ee(){const[e,t]=s.useState(!1),[a,n]=s.useState(null),[,i]=r(),{toast:c}=l(),o=d({resolver:Z(_),defaultValues:{username:"",password:"",secretKey:""}});return m.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background p-4",children:m.jsxs(u,{className:"w-full max-w-md shadow-xl border-muted-foreground/20",children:[m.jsxs(h,{className:"space-y-1",children:[m.jsxs(x,{className:"text-2xl font-bold text-center flex items-center justify-center gap-2",children:[m.jsx(j,{className:"h-6 w-6"}),"Admin Access"]}),m.jsx(f,{className:"text-center",children:"Secure admin portal for Goombas management"})]}),m.jsxs(p,{children:[a&&m.jsxs(g,{variant:"destructive",className:"mb-4",children:[m.jsx(y,{className:"h-4 w-4"}),m.jsx(b,{children:"Error"}),m.jsx(N,{children:a})]}),m.jsx(v,{...o,children:m.jsxs("form",{onSubmit:o.handleSubmit((async e=>{t(!0),n(null);try{const s=await fetch("/goombas.net/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!s.ok){const e=await s.json();throw new Error(e.message||"Authentication failed")}c({title:"Authentication successful",description:"Redirecting to admin dashboard..."}),i("/goombas.net/dashboard")}catch(s){n(s instanceof Error?s.message:"An unexpected error occurred"),c({variant:"destructive",title:"Authentication failed",description:s instanceof Error?s.message:"An unexpected error occurred"})}finally{t(!1)}})),className:"space-y-4",children:[m.jsx(w,{control:o.control,name:"username",render:({field:e})=>m.jsxs(A,{children:[m.jsx(E,{children:"Username"}),m.jsx(S,{children:m.jsx(k,{placeholder:"Enter your username",...e})}),m.jsx(R,{})]})}),m.jsx(w,{control:o.control,name:"password",render:({field:e})=>m.jsxs(A,{children:[m.jsx(E,{children:"Password"}),m.jsx(S,{children:m.jsx(k,{type:"password",placeholder:"Enter your password",...e})}),m.jsx(R,{})]})}),m.jsx(w,{control:o.control,name:"secretKey",render:({field:e})=>m.jsxs(A,{children:[m.jsx(E,{children:"Secret Key"}),m.jsx(S,{children:m.jsx(k,{type:"password",placeholder:"Enter your secret key",...e})}),m.jsx(R,{})]})}),m.jsx(U,{type:"submit",className:"w-full bg-primary hover:bg-primary/90",disabled:e,children:e?"Authenticating...":"Log In"})]})})]}),m.jsx(P,{className:"flex flex-col",children:m.jsx("p",{className:"px-8 text-center text-sm text-muted-foreground",children:"This is a secure area. Unauthorized access is prohibited and monitored."})})]})})}function se(){const[e,t]=s.useState(!0),[a,n]=s.useState(null),[i,c]=s.useState(null),[o,d]=s.useState(null),[,j]=r(),{toast:v}=l();return s.useEffect((()=>{(async()=>{await async function(){try{const e=await fetch("/goombas.net/auth-status",{credentials:"include"}),s=await e.json();return e.ok&&s.isAdmin?(d(!0),!0):(d(!1),j("/goombas.net/login"),!1)}catch(e){return d(!1),j("/goombas.net/login"),!1}}()&&async function(){try{t(!0),n(null);const e=await fetch("/goombas.net/analytics",{credentials:"include"});if(!e.ok){if(401===e.status)return d(!1),void j("/goombas.net/login");const s=await e.json();throw new Error(s.message||"Failed to load analytics")}const s=await e.json();c(s)}catch(e){n(e instanceof Error?e.message:"An unexpected error occurred"),v({variant:"destructive",title:"Failed to load analytics",description:e instanceof Error?e.message:"An unexpected error occurred"})}finally{t(!1)}}()})()}),[]),null===o?m.jsx("div",{className:"flex items-center justify-center min-h-screen",children:m.jsx("div",{className:"animate-pulse",children:"Checking authentication..."})}):!1===o?m.jsx("div",{className:"flex items-center justify-center min-h-screen",children:m.jsxs(g,{variant:"destructive",className:"max-w-md",children:[m.jsx(y,{className:"h-4 w-4"}),m.jsx(b,{children:"Authentication Required"}),m.jsx(N,{children:"You need to be logged in as an admin to access this page. Redirecting to login..."})]})}):m.jsx("div",{className:"min-h-screen bg-background p-6",children:m.jsxs("div",{className:"max-w-7xl mx-auto",children:[m.jsxs("div",{className:"flex justify-between items-center mb-8",children:[m.jsx("h1",{className:"text-3xl font-bold",children:"Goombas Admin Dashboard"}),m.jsxs(U,{variant:"outline",className:"flex items-center gap-2",onClick:async function(){try{if(!(await fetch("/goombas.net/logout",{method:"POST",credentials:"include"})).ok)throw new Error("Logout failed");v({title:"Logged out successfully",description:"Redirecting to login page..."}),d(!1),j("/goombas.net/login")}catch(e){v({variant:"destructive",title:"Logout failed",description:e instanceof Error?e.message:"An unexpected error occurred"})}},children:[m.jsx(L,{className:"h-4 w-4"}),"Logout"]})]}),a&&m.jsxs(g,{variant:"destructive",className:"mb-6",children:[m.jsx(y,{className:"h-4 w-4"}),m.jsx(b,{children:"Error"}),m.jsx(N,{children:a})]}),e?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[...Array(3)].map(((e,s)=>m.jsxs(u,{className:"animate-pulse",children:[m.jsxs(h,{children:[m.jsx("div",{className:"h-5 bg-muted rounded w-1/2 mb-2"}),m.jsx("div",{className:"h-4 bg-muted rounded w-1/3"})]}),m.jsxs(p,{children:[m.jsx("div",{className:"h-8 bg-muted rounded w-1/4 mb-4"}),m.jsx("div",{className:"space-y-2",children:[...Array(3)].map(((e,s)=>m.jsx("div",{className:"h-4 bg-muted rounded w-full"},s)))})]})]},s)))}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[m.jsxs(u,{children:[m.jsxs(h,{className:"pb-2",children:[m.jsxs(x,{className:"flex items-center gap-2",children:[m.jsx(C,{className:"h-5 w-5 text-primary"}),"User Statistics"]}),m.jsx(f,{children:"Total registered users"})]}),m.jsxs(p,{children:[m.jsx("div",{className:"text-3xl font-bold mb-2",children:(null==i?void 0:i.totalUsers)??0}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Active users across the platform"})]})]}),m.jsxs(u,{children:[m.jsxs(h,{className:"pb-2",children:[m.jsxs(x,{className:"flex items-center gap-2",children:[m.jsx(O,{className:"h-5 w-5 text-primary"}),"System Activity"]}),m.jsx(f,{children:"Key platform metrics"})]}),m.jsx(p,{children:m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Wheel Spins"}),m.jsx("p",{className:"font-medium",children:(null==i?void 0:i.stats.wheelSpins)??0})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Bonus Codes"}),m.jsx("p",{className:"font-medium",children:(null==i?void 0:i.stats.bonusCodes)??0})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Wager Races"}),m.jsx("p",{className:"font-medium",children:(null==i?void 0:i.stats.wagerRaces)??0})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"Race Participants"}),m.jsx("p",{className:"font-medium",children:(null==i?void 0:i.stats.wagerRaceParticipants)??0})]})]})})]}),m.jsxs(u,{children:[m.jsxs(h,{className:"pb-2",children:[m.jsxs(x,{className:"flex items-center gap-2",children:[m.jsx(T,{className:"h-5 w-5 text-primary"}),"Support Tickets"]}),m.jsx(f,{children:"Customer support status"})]}),m.jsxs(p,{children:[m.jsx("div",{className:"text-3xl font-bold mb-2",children:(null==i?void 0:i.stats.supportTickets)??0}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Active support tickets in the system"})]})]})]}),m.jsxs(u,{className:"mb-6",children:[m.jsxs(h,{children:[m.jsxs(x,{className:"flex items-center gap-2",children:[m.jsx(V,{className:"h-5 w-5 text-primary"}),"Recent User Registrations"]}),m.jsx(f,{children:"The most recently registered users on the platform"})]}),m.jsx(p,{children:m.jsxs(K,{children:[m.jsx(q,{children:m.jsxs(D,{children:[m.jsx(F,{children:"ID"}),m.jsx(F,{children:"Username"}),m.jsx(F,{children:"Email"}),m.jsx(F,{children:"Created At"}),m.jsx(F,{children:"Admin"})]})}),m.jsx(I,{children:(null==i?void 0:i.recentUsers)&&i.recentUsers.length>0?i.recentUsers.map((e=>m.jsxs(D,{children:[m.jsx(G,{children:e.id}),m.jsx(G,{className:"font-medium",children:e.username}),m.jsx(G,{children:e.email}),m.jsx(G,{children:new Date(e.createdAt).toLocaleDateString()}),m.jsx(G,{children:e.isAdmin?m.jsx("span",{className:"px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs",children:"Yes"}):m.jsx("span",{className:"px-2 py-1 rounded-full bg-gray-100 text-gray-800 text-xs",children:"No"})})]},e.id))):m.jsx(D,{children:m.jsx(G,{colSpan:5,className:"text-center",children:"No users found"})})})]})})]})]})]})})}function re({path:e,component:r}){const{user:n,loading:i,isAdmin:c}=W();return s.useEffect((()=>{if(!(()=>{const e=window.location.hostname;return"goombas.net"===e||e.includes("goombas.net")||e.includes("goombas.")})()){const e=`https://goombas.net${window.location.pathname}`;window.location.href=e}}),[]),i?m.jsx(t,{path:e,children:m.jsx("div",{className:"flex items-center justify-center min-h-screen",children:m.jsx(z,{className:"h-8 w-8 animate-spin text-border"})})}):n&&c?m.jsx(t,{path:e,component:r}):m.jsx(t,{path:e,children:m.jsx(a,{to:"/"})})}export{re as A,ee as G,se as a,M as b,B as c,Z as t};
